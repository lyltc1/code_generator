import time
from tqdm import tqdm
from contextlib import contextmanager
from itertools import combinations

N = 10
# 该情况下前中后三段互不影响，

@contextmanager
def timer(text='', do=True):
    if do:
        start = time.time()
        try:
            yield
        finally:
            print(f'{text}: {time.time() - start:.4}s')
    else:
        yield


# 由于三条子序列重组N次的结果数量相同，所以只需求第一条序列重组N次的结果
# 进一步地，把问题改成list(1234567)，同向重组相当于删除连续的偶数个字符，比如变成“14567”，反向重组相当于连续奇数个字符反向加负号，比如变成“-3-2-14567”
result = {0: list()}
result[0].append(tuple([1, 2, 3, 4, 5, 6, 7]))

for n in range(1, N):
    result[n] = list()
    for l in result[n - 1]:
        # 同向重组,去掉连续i（注：i是偶数）个字符
        for i in range(2, len(l) + 1, 2):
            for j in range(0, len(l) - i + 1):
                result[n].append(l[:j] + l[j + i:])
        # 反向重组，连续i(i是奇数）个字符反向
        for i in range(1, len(l) + 1, 2):
            for j in range(0, len(l) - i + 1):
                result[n].append(l[:j] + tuple([-item for item in reversed(l[j:j + i])]) + l[j + i:])
    result[n] = list(set(result[n]))
    result[n].sort()

print("对于第一个子链:")
for n in range(1, N):
    print(f"n={n},有{len(result[n])}种不同重组")

print("对于q_1_2_3：")

# 构造一个字典，例如（m,n,t）表示m次重组和n次重组和t次重组都包含重复的结果的数量
dict_2 = {}
for i in range(1, N+1):
    for combines in combinations(range(N), i):
        s = list()
        for item in combines:
            s.append(set(result[item]))
        for j in range(len(s)):
            if j == 0:
                c = s[0]
            else:
                c = c & s[j]
        dict_2[combines] = len(c)


def get_result(a):
    """ 函数输入的是所有可能的组合方式，
        比如 a = [(0, 0, 2), (0, 1, 1), (0, 2, 0), (1, 0, 1), (1, 1, 0), (2, 0, 0)]
            [注:(0,1,1)表示第2段重组1次，第3段也重组1次，第1段重组0次]
        函数需要输出在上述所有分割情况不重复的可能性
        根据容斥原理，参见https://wenku.baidu.com/view/859bb2fa4a649b6648d7c1c708a1284ac8500519.html：
            原理解释：比如len(集合1并集合2并集合3）= len（集合1）+len（集合2）+len（集合3）
                                             -len（集合1交集合2）-len（集合2交集合3）-len（集合1交集合3）
                                             +len（集合1交集合2交集合3）

    """
    result = 0
    for i in tqdm(range(1, len(a)), "总进度条"):
        for l in combinations(a, i):
            # 求l的并集
            index = {0: [], 1: [], 2: []}
            for k in range(len(l)):
                for j in range(3):
                    index[j].append(l[k][j])
            for j in range(3):
                index[j] = list(set(index[j]))
                index[j] = tuple(sorted(index[j]))
            result += (-1) ** (i + 1) * dict_2[index[0]] * dict_2[index[1]] * dict_2[index[2]]
    return result

for n in range(1, N):
    # a 存储n次重组可以分配的重组方式，比如一次重组可以分为[(0, 0, 1), (0, 1, 0), (1, 0, 0)]， 其中(1, 0, 0)表示重组发生在第一段
    a = []
    for i in range(0, n + 1):  # 第一个子链重组次数
        for j in range(0, n - i + 1):  # 第二个子链重组次数
            k = n - i - j  # 第三个子链重组次数
            a.append((i, j, k))

    result = get_result(a)
    print(f"n={n}, 有{result}种重组")


# 运行结果：
# 对于第一个子链:
# n=1,有28种不同重组
# n=2,有245种不同重组
# n=3,有1378种不同重组
# n=4,有4933种不同重组
# n=5,有10524种不同重组
# n=6,有14100种不同重组
# n=7,有14120种不同重组
# n=8,有14120种不同重组
# n=9,有14120种不同重组
# 对于q_1_2_3：
# 进度条2: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:00<00:00, 61680.94it/s]
# 进度条2: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:00<00:00, 22389.52it/s]
# 进度条: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00, 2237.56it/s]
# n=1, 有84种重组
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6/6 [00:00<00:00, 159277.37it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [00:00<00:00, 132451.71it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00<00:00, 139577.50it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [00:00<00:00, 186137.75it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6/6 [00:00<00:00, 123969.58it/s]
# 进度条: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:00<00:00, 2497.50it/s]
# n=2, 有3085种重组
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:00<00:00, 204600.20it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 45/45 [00:00<00:00, 235635.06it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 120/120 [00:00<00:00, 262691.27it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:00<00:00, 250086.27it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 252/252 [00:00<00:00, 220752.84it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:00<00:00, 201926.60it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 120/120 [00:00<00:00, 192105.53it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 45/45 [00:00<00:00, 138578.33it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:00<00:00, 123000.12it/s]
# 进度条: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9/9 [00:00<00:00, 1258.92it/s]
# n=3, 有66646种重组
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [00:00<00:00, 193583.26it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 105/105 [00:00<00:00, 300205.81it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 455/455 [00:00<00:00, 255373.79it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1365/1365 [00:00<00:00, 248879.54it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3003/3003 [00:00<00:00, 232724.12it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5005/5005 [00:00<00:00, 215484.41it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6435/6435 [00:00<00:00, 195449.09it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6435/6435 [00:00<00:00, 182111.26it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5005/5005 [00:00<00:00, 168246.81it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3003/3003 [00:00<00:00, 159056.12it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1365/1365 [00:00<00:00, 150651.92it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 455/455 [00:00<00:00, 141258.94it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 105/105 [00:00<00:00, 131189.13it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [00:00<00:00, 107730.41it/s]
# 进度条: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 14/14 [00:00<00:00, 74.22it/s]
# n=4, 有978733种重组
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 21/21 [00:00<00:00, 268537.76it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:00<00:00, 310251.44it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1330/1330 [00:00<00:00, 284250.92it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5985/5985 [00:00<00:00, 257188.77it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20349/20349 [00:00<00:00, 232337.54it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 54264/54264 [00:00<00:00, 213894.02it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 116280/116280 [00:00<00:00, 197746.18it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 203490/203490 [00:01<00:00, 186139.01it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 293930/293930 [00:01<00:00, 171681.07it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 352716/352716 [00:02<00:00, 161039.61it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 352716/352716 [00:02<00:00, 151711.67it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 293930/293930 [00:02<00:00, 142213.12it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 203490/203490 [00:01<00:00, 135455.36it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 116280/116280 [00:00<00:00, 128577.11it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 54264/54264 [00:00<00:00, 123349.11it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20349/20349 [00:00<00:00, 117150.52it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5985/5985 [00:00<00:00, 110131.88it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1330/1330 [00:00<00:00, 106227.37it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 210/210 [00:00<00:00, 101323.35it/s]
# 进度条2: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 21/21 [00:00<00:00, 88256.90it/s]
# 进度条: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:13<00:00,  1.46it/s]
# n=5, 有10706692种重组
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 28/28 [00:00<00:00, 292140.58it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 378/378 [00:00<00:00, 316014.93it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3276/3276 [00:00<00:00, 289274.52it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20475/20475 [00:00<00:00, 256541.74it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 98280/98280 [00:00<00:00, 238160.86it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 376740/376740 [00:01<00:00, 216717.80it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1184040/1184040 [00:05<00:00, 200411.54it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3108105/3108105 [00:16<00:00, 185312.14it/s]
# 进度条2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6906900/6906900 [00:40<00:00, 169163.68it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 13123110/13123110 [01:22<00:00, 159731.25it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 21474180/21474180 [02:24<00:00, 148559.03it/s]
# 进度条2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 30421755/30421755 [03:34<00:00, 141962.93it/s]
# 进度条:  44%|█████████████████████████████████████████████████████████████████████████████▎                                                                                                | 12/27 [08:38<27:38, 110.53s/it]
# 进度条2:   4%|██████▏                                                                                                                                                        | 1462251/37442160 [00:10<04:26, 135238.90it/s]